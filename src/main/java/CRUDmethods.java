import okhttp3.*;
import org.hl7.fhir.r5.model.AllergyIntolerance;

import java.io.IOException;

public class CRUDmethods {

    public static void create() {
        OkHttpClient client = new OkHttpClient().newBuilder()
                .build();
        MediaType mediaType = MediaType.parse("application/fhir+xml");
        RequestBody body = RequestBody.create(mediaType, "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<AllergyIntolerance xmlns=\"http://hl7.org/fhir\">\r\n  <id value=\"example\"/> \r\n\r\n  <!--    an identifier used for this allergic propensity (adverse reaction risk)    -->\r\n  <text> <status value=\"generated\"/> <div xmlns=\"http://www.w3.org/1999/xhtml\"><p> <b> Generated Narrative with Details</b> </p> <p> <b> id</b> : example</p> <p> <b> identifier</b> : 49476534</p> <p> <b> clinicalStatus</b> : Active <span> (Details : {http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical code 'active'\r\n           = 'Active', given as 'Active'})</span> </p> <p> <b> verificationStatus</b> : Confirmed <span> (Details : {http://terminology.hl7.org/CodeSystem/allergyintolerance-verification code\r\n           'confirmed' = 'Confirmed', given as 'Confirmed'})</span> </p> <p> <b> type</b> : allergy</p> <p> <b> category</b> : food</p> <p> <b> criticality</b> : high</p> <p> <b> code</b> : Cashew nuts <span> (Details : {SNOMED CT code '227493005' = 'Cashew nuts', given as 'Cashew nuts'})</span> </p> <p> <b> patient</b> : <a> Patient/example</a> </p> <p> <b> onset</b> : 01/01/2004</p> <p> <b> recordedDate</b> : 09/10/2014 2:58:00 PM</p> <p> <b> recorder</b> : <a> Practitioner/example</a> </p> <p> <b> asserter</b> : <a> Patient/example</a> </p> <p> <b> lastOccurrence</b> : 01/06/2012</p> <p> <b> note</b> : The criticality is high becasue of the observed anaphylactic reaction when challenged\r\n         with cashew extract.</p> <blockquote> <p> <b> reaction</b> </p> <p> <b> substance</b> : cashew nut allergenic extract Injectable Product <span> (Details : {RxNorm code '1160593' = 'cashew nut allergenic extract Injectable Product',\r\n             given as 'cashew nut allergenic extract Injectable Product'})</span> </p> <p> <b> manifestation</b> : Anaphylactic reaction <span> (Details : {SNOMED CT code '39579001' = 'Anaphylaxis', given as 'Anaphylactic reaction'})</span> </p> <p> <b> description</b> : Challenge Protocol. Severe reaction to subcutaneous cashew extract. Epinephrine administered</p> <p> <b> onset</b> : 12/06/2012</p> <p> <b> severity</b> : severe</p> <p> <b> exposureRoute</b> : Subcutaneous route <span> (Details : {SNOMED CT code '34206005' = 'Subcutaneous route', given as 'Subcutaneous route'})</span> </p> </blockquote> <blockquote> <p> <b> reaction</b> </p> <p> <b> manifestation</b> : Urticaria <span> (Details : {SNOMED CT code '64305001' = 'Urticaria', given as 'Urticaria'})</span> </p> <p> <b> onset</b> : 01/01/2004</p> <p> <b> severity</b> : moderate</p> <p> <b> note</b> : The patient reports that the onset of urticaria was within 15 minutes of eating cashews.</p> </blockquote> </div> </text> <identifier> \r\n    <system value=\"http://acme.com/ids/patients/risks\"/> \r\n    <value value=\"49476534\"/> \r\n  </identifier> \r\n\r\n  <!--    this individual has had several reactions    -->   \r\n  <clinicalStatus> \r\n    <coding> \r\n      <system value=\"http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical\"/> \r\n      <code value=\"active\"/> \r\n      <display value=\"Active\"/> \r\n    </coding> \r\n  </clinicalStatus> \r\n\r\n  <verificationStatus> \r\n    <coding> \r\n      <system value=\"http://terminology.hl7.org/CodeSystem/allergyintolerance-verification\"/> \r\n      <code value=\"confirmed\"/> \r\n      <display value=\"Confirmed\"/> \r\n    </coding> \r\n  </verificationStatus> \r\n  \r\n  <!--    note: it's often unknown whether an allergy is mediated by an immune response, and\r\n   not as significant as once thought    -->\r\n  <type value=\"allergy\"/> \r\n  \r\n  <!--    this categorization is implied by \"cashew nut\" and therefore basically \r\n    redundant, but many systems collect this field anyway, since it's either \r\n    useful when the substance is not coded, or it's quicker to sort/filter on\r\n    than using terminology based reasoning    -->\r\n\r\n  \r\n  <category value=\"food\"/> \r\n     \r\n  <!--    there is no question that the allergy is real and serious    --> \r\n  <criticality value=\"high\"/> \r\n  \r\n  <!--    Allergy or intolerance code (substance, product, condition or negated/excluded statement)\r\n   or text. A few times, \r\n    there's a full description of a complex substance/product - in these caes, use the\r\n    extension [url] to refer to a Substance resource.    -->\r\n  <code> \r\n    <coding> \r\n      <system value=\"http://snomed.info/sct\"/> \r\n      <code value=\"227493005\"/> \r\n      <display value=\"Cashew nuts\"/> \r\n    </coding> \r\n  </code> \r\n \r\n  <!--    the patient that actually has the risk of adverse reaction    -->\r\n  <patient> \r\n    <reference value=\"Patient/example\"/> \r\n  </patient> \r\n\r\n  <!--    when the allergy was first noted (in this case the same as reaction.onset of the first\r\n   occurrence)    --> \r\n  <onsetDateTime value=\"2004\"/> \r\n\r\n  <!--    the date that this entry was recorded    -->  \r\n  <recordedDate value=\"2014-10-09T14:58:00+11:00\"/> \r\n  \r\n  <!--    who made the record / last updated it    -->\r\n  <recorder> \r\n    <reference value=\"Practitioner/example\"/> \r\n  </recorder> \r\n  \r\n  <!--    the patient is the reporter in this case    -->\r\n  <asserter> \r\n    <reference value=\"Patient/example\"/> \r\n  </asserter> \r\n\r\n  <!--    last happened June 2012. Typically, systems either track lastOccurrence,\r\n     or a list of events.    -->\r\n  <lastOccurrence value=\"2012-06\"/> \r\n  \r\n  <!--    an additional note about the allergy propensity by the recorder    -->\r\n  <note> \r\n    <text value=\"The criticality is high becasue of the observed anaphylactic reaction when challenged\r\n     with cashew extract.\"/> \r\n  </note>   \r\n  \r\n  <!--    past events. There's no claim that this is all the events, and \r\n     that should not be assumed    -->\r\n  <reaction>  \r\n    <!--    \r\n      It's possible to list specific things to which the patient responded,\r\n      e.g. chocolate (that happened to contain cashew nuts). This event has\r\n      such a specific substance. Note that systems should ensure that what\r\n      goes in here does not conflict with the substance above, and systems\r\n      processing the data can be sure that what is here does not contravene\r\n      the substance above\r\n       -->\r\n    <substance> \r\n      <coding> \r\n        <system value=\"http://www.nlm.nih.gov/research/umls/rxnorm\"/> \r\n        <code value=\"1160593\"/> \r\n        <display value=\"cashew nut allergenic extract Injectable Product\"/> \r\n      </coding>   \r\n    </substance> \r\n    <manifestation> \r\n      <coding> \r\n        <system value=\"http://snomed.info/sct\"/> \r\n        <code value=\"39579001\"/> \r\n        <display value=\"Anaphylactic reaction\"/> \r\n      </coding> \r\n    </manifestation> \r\n    <description value=\"Challenge Protocol. Severe reaction to subcutaneous cashew extract. Epinephrine administered\"/> \r\n    <onset value=\"2012-06-12\"/> \r\n    <severity value=\"severe\"/> \r\n    <exposureRoute> \r\n      <coding> \r\n        <system value=\"http://snomed.info/sct\"/> \r\n        <code value=\"34206005\"/> \r\n        <display value=\"Subcutaneous route\"/> \r\n      </coding> \r\n    </exposureRoute> \r\n  </reaction> \r\n\r\n  <!--    this was the first occurrence    -->\r\n  <reaction>  \r\n    <manifestation> \r\n      <coding> \r\n        <system value=\"http://snomed.info/sct\"/> \r\n        <code value=\"64305001\"/> \r\n        <display value=\"Urticaria\"/> \r\n      </coding> \r\n    </manifestation> \r\n    <onset value=\"2004\"/> \r\n    <severity value=\"moderate\"/> \r\n    <!--    an additional note about the reaction by the recorder    -->\r\n    <note> \r\n      <text value=\"The patient reports that the onset of urticaria was within 15 minutes of eating cashews.\"/> \r\n    </note>   \r\n  </reaction> \r\n  \r\n</AllergyIntolerance> ");
        Request request = new Request.Builder()
                .url("http://hapi.fhir.org/baseR4/AllergyIntolerance")
                .method("POST", body)
                .addHeader("Content-Type", "application/fhir+xml")
                .build();
        try {
            Response response = client.newCall(request).execute();
            System.out.println(response.body().string());
        } catch (IOException e) {
            e.printStackTrace();
        }

    }

    public static void read() {
        OkHttpClient client = new OkHttpClient().newBuilder()
                .build();
        Request request = new Request.Builder()
                .url("http://hapi.fhir.org/baseR4/AllergyIntolerance/")
                .method("GET", null)
                .addHeader("Content-Type", "application/fhir+xml")
                .build();
        Response response = null;
        try {
            response = client.newCall(request).execute();
            System.out.println(response.body().string());
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static void update() {
        OkHttpClient client = new OkHttpClient().newBuilder()
                .build();
        MediaType mediaType = MediaType.parse("application/xml");
        RequestBody body = RequestBody.create(mediaType, "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<AllergyIntolerance xmlns=\"http://hl7.org/fhir\">\r\n  <id value=\"example\"/> \r\n\r\n  <!--    an identifier used for this allergic propensity (adverse reaction risk)    -->\r\n  <text> <status value=\"generated\"/> <div xmlns=\"http://www.w3.org/1999/xhtml\"><p> <b> Generated Narrative with Details</b> </p> <p> <b> id</b> : example</p> <p> <b> identifier</b> : 49476534</p> <p> <b> clinicalStatus</b> : Active <span> (Details : {http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical code 'active'\r\n           = 'Active', given as 'Active'})</span> </p> <p> <b> verificationStatus</b> : Confirmed <span> (Details : {http://terminology.hl7.org/CodeSystem/allergyintolerance-verification code\r\n           'confirmed' = 'Confirmed', given as 'Confirmed'})</span> </p> <p> <b> type</b> : allergy</p> <p> <b> category</b> : food</p> <p> <b> criticality</b> : high</p> <p> <b> code</b> : Cashew nuts <span> (Details : {SNOMED CT code '227493005' = 'Cashew nuts', given as 'Cashew nuts'})</span> </p> <p> <b> patient</b> : <a> Patient/example</a> </p> <p> <b> onset</b> : 01/01/2004</p> <p> <b> recordedDate</b> : 09/10/2014 2:58:00 PM</p> <p> <b> recorder</b> : <a> Practitioner/example</a> </p> <p> <b> asserter</b> : <a> Patient/example</a> </p> <p> <b> lastOccurrence</b> : 01/06/2012</p> <p> <b> note</b> : The criticality is high becasue of the observed anaphylactic reaction when challenged\r\n         with cashew extract.</p> <blockquote> <p> <b> reaction</b> </p> <p> <b> substance</b> : cashew nut allergenic extract Injectable Product <span> (Details : {RxNorm code '1160593' = 'cashew nut allergenic extract Injectable Product',\r\n             given as 'cashew nut allergenic extract Injectable Product'})</span> </p> <p> <b> manifestation</b> : Anaphylactic reaction <span> (Details : {SNOMED CT code '39579001' = 'Anaphylaxis', given as 'Anaphylactic reaction'})</span> </p> <p> <b> description</b> : Challenge Protocol. Severe reaction to subcutaneous cashew extract. Epinephrine administered</p> <p> <b> onset</b> : 12/06/2012</p> <p> <b> severity</b> : severe</p> <p> <b> exposureRoute</b> : Subcutaneous route <span> (Details : {SNOMED CT code '34206005' = 'Subcutaneous route', given as 'Subcutaneous route'})</span> </p> </blockquote> <blockquote> <p> <b> reaction</b> </p> <p> <b> manifestation</b> : Urticaria <span> (Details : {SNOMED CT code '64305001' = 'Urticaria', given as 'Urticaria'})</span> </p> <p> <b> onset</b> : 01/01/2004</p> <p> <b> severity</b> : moderate</p> <p> <b> note</b> : The patient reports that the onset of urticaria was within 15 minutes of eating cashews.</p> </blockquote> </div> </text> <identifier> \r\n    <system value=\"http://acme.com/ids/patients/risks\"/> \r\n    <value value=\"49476534\"/> \r\n  </identifier> \r\n\r\n  <!--    this individual has had several reactions    -->   \r\n  <clinicalStatus> \r\n    <coding> \r\n      <system value=\"http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical\"/> \r\n      <code value=\"active\"/> \r\n      <display value=\"Active\"/> \r\n    </coding> \r\n  </clinicalStatus> \r\n\r\n  <verificationStatus> \r\n    <coding> \r\n      <system value=\"http://terminology.hl7.org/CodeSystem/allergyintolerance-verification\"/> \r\n      <code value=\"confirmed\"/> \r\n      <display value=\"Confirmed\"/> \r\n    </coding> \r\n  </verificationStatus> \r\n  \r\n  <!--    note: it's often unknown whether an allergy is mediated by an immune response, and\r\n   not as significant as once thought    -->\r\n  <type value=\"allergy\"/> \r\n  \r\n  <!--    this categorization is implied by \"cashew nut\" and therefore basically \r\n    redundant, but many systems collect this field anyway, since it's either \r\n    useful when the substance is not coded, or it's quicker to sort/filter on\r\n    than using terminology based reasoning    -->\r\n\r\n  \r\n  <category value=\"food\"/> \r\n     \r\n  <!--    there is no question that the allergy is real and serious    --> \r\n  <criticality value=\"high\"/> \r\n  \r\n  <!--    Allergy or intolerance code (substance, product, condition or negated/excluded statement)\r\n   or text. A few times, \r\n    there's a full description of a complex substance/product - in these caes, use the\r\n    extension [url] to refer to a Substance resource.    -->\r\n  <code> \r\n    <coding> \r\n      <system value=\"http://snomed.info/sct\"/> \r\n      <code value=\"227493005\"/> \r\n      <display value=\"Cashew nuts\"/> \r\n    </coding> \r\n  </code> \r\n \r\n  <!--    the patient that actually has the risk of adverse reaction    -->\r\n  <patient> \r\n    <reference value=\"Patient/example\"/> \r\n  </patient> \r\n\r\n  <!--    when the allergy was first noted (in this case the same as reaction.onset of the first\r\n   occurrence)    --> \r\n  <onsetDateTime value=\"2004\"/> \r\n\r\n  <!--    the date that this entry was recorded    -->  \r\n  <recordedDate value=\"2014-10-09T14:58:00+11:00\"/> \r\n  \r\n  <!--    who made the record / last updated it    -->\r\n  <recorder> \r\n    <reference value=\"Practitioner/example\"/> \r\n  </recorder> \r\n  \r\n  <!--    the patient is the reporter in this case    -->\r\n  <asserter> \r\n    <reference value=\"Patient/example\"/> \r\n  </asserter> \r\n\r\n  <!--    last happened June 2012. Typically, systems either track lastOccurrence,\r\n     or a list of events.    -->\r\n  <lastOccurrence value=\"2012-06\"/> \r\n  \r\n  <!--    an additional note about the allergy propensity by the recorder    -->\r\n  <note> \r\n    <text value=\"The criticality is high becasue of the observed anaphylactic reaction when challenged\r\n     with cashew extract.\"/> \r\n  </note>   \r\n  \r\n  <!--    past events. There's no claim that this is all the events, and \r\n     that should not be assumed    -->\r\n  <reaction>  \r\n    <!--    \r\n      It's possible to list specific things to which the patient responded,\r\n      e.g. chocolate (that happened to contain cashew nuts). This event has\r\n      such a specific substance. Note that systems should ensure that what\r\n      goes in here does not conflict with the substance above, and systems\r\n      processing the data can be sure that what is here does not contravene\r\n      the substance above\r\n       -->\r\n    <substance> \r\n      <coding> \r\n        <system value=\"http://www.nlm.nih.gov/research/umls/rxnorm\"/> \r\n        <code value=\"1160593\"/> \r\n        <display value=\"cashew nut allergenic extract Injectable Product\"/> \r\n      </coding>   \r\n    </substance> \r\n    <manifestation> \r\n      <coding> \r\n        <system value=\"http://snomed.info/sct\"/> \r\n        <code value=\"39579001\"/> \r\n        <display value=\"Anaphylactic reaction\"/> \r\n      </coding> \r\n    </manifestation> \r\n    <description value=\"Challenge Protocol. Severe reaction to subcutaneous cashew extract. Epinephrine administered\"/> \r\n    <onset value=\"2012-06-12\"/> \r\n    <severity value=\"severe\"/> \r\n    <exposureRoute> \r\n      <coding> \r\n        <system value=\"http://snomed.info/sct\"/> \r\n        <code value=\"34206005\"/> \r\n        <display value=\"Subcutaneous route\"/> \r\n      </coding> \r\n    </exposureRoute> \r\n  </reaction> \r\n\r\n  <!--    this was the first occurrence    -->\r\n  <reaction>  \r\n    <manifestation> \r\n      <coding> \r\n        <system value=\"http://snomed.info/sct\"/> \r\n        <code value=\"64305001\"/> \r\n        <display value=\"Urticaria\"/> \r\n      </coding> \r\n    </manifestation> \r\n    <onset value=\"2004\"/> \r\n    <severity value=\"moderate\"/> \r\n    <!--    an additional note about the reaction by the recorder    -->\r\n    <note> \r\n      <text value=\"The patient reports that the onset of urticaria was within 15 minutes of eating cashews.\"/> \r\n    </note>   \r\n  </reaction> \r\n  \r\n</AllergyIntolerance> ");
        Request request = new Request.Builder()
                .url("http://hapi.fhir.org/baseR4/AllergyIntolerance/example?")
                .method("PUT", body)
                .addHeader("Content-Type", "application/xml")
                .build();
        try {
        Response response = client.newCall(request).execute();
        System.out.println(response.body().string());
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static void delete() {
        OkHttpClient client = new OkHttpClient().newBuilder()
                .build();
        MediaType mediaType = MediaType.parse("application/fhir+xml");
        RequestBody body = RequestBody.create(mediaType, "");
        Request request = new Request.Builder()
                .url("http://hapi.fhir.org/baseR4/AllergyIntolerance/example")
                .method("DELETE", body)
                .addHeader("Content-Type", "application/fhir+xml")
                .build();
        try {
            Response response = client.newCall(request).execute();
            System.out.println(response.body().string());
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
